<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>SEKAI DOTA BOOST - Monte seu Boost</title>
<style>
:root{
  --bg-top:#9f7dfc;
  --bg-bottom:#443064;
  --card:#221425bb;
  --card-soft:#141824;
  --primary:#8b5cf6;
  --text:#f3f4f6;
  --muted:#c4aeca;
  --danger:#ef4444;
  --success:#22c55e;
}
*{box-sizing:border-box;font-family:Arial, Helvetica, sans-serif}
body{
  margin:0;
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;

  background:
    linear-gradient(
      rgba(15, 17, 23, 0.349),
      rgba(15, 17, 23, 0.349)
    ),
    url("sua-imagem-cosmica.png");

  background-size: cover;
  background-position: center;
  background-attachment: fixed;

  color:var(--text);
}
.sub{
  margin-top:2px;   /* bem pr√≥ximo */
  line-height:1.2;
  color:#ffffff;
  font-size:14px;
}
.wrap{
  width:100%;
  max-width:1100px;
  padding:20px;
}


.grid{display:grid;grid-template-columns:1fr;gap:14px;}
@media(min-width:980px){.grid{grid-template-columns:1fr 1fr;}}
.card{
  background:var(--card);
  border-radius:18px;
  padding:18px;
  box-shadow:0 20px 45px rgba(162, 0, 255, 0.171);
}
.card h2{
  margin:0;
  font-size:16px;
  color:var(--muted);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.pill{
  font-size:12px;
  padding:6px 10px;
  border-radius:999px;
  background:rgba(128, 74, 255, 0.247);
  color:var(--muted);
  border:1px solid rgba(128, 74, 255, 0.247);
}
label{display:block;margin-top:10px;margin-bottom:6px;font-size:13px}
input[type=number], input[type=text]{
  width:100%;
  padding:11px 12px;
  border-radius:12px;
  border:1px solid #2a2f45;
  background:var(--card-soft);
  color:var(--text);
}
.two{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.check{display:flex;gap:8px;align-items:center;margin-top:10px;font-size:13px}
small.muted{color:var(--muted)}
.result{
  margin-top:12px;
  padding:12px;
  border-radius:12px;
  background:var(--card-soft);
  min-height:62px;
  font-size:13px;
}
.alert{margin-top:8px;color:var(--danger);font-size:13px}
.ok{color:var(--success)}
details{margin-top:10px;color:var(--muted);font-size:13px}
summary{cursor:pointer}
.big{grid-column:1 / -1;}
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:14px;
  background:var(--primary);
  color:white;
  font-size:16px;
  cursor:pointer;
}
button:disabled{opacity:.55;cursor:not-allowed;}
.footer{text-align:center;margin-top:12px;color:var(--muted);font-size:12px}
.badge{display:none;margin-top:8px;font-size:12px;color:var(--success)}
/* collapsible sections */
.serviceBody{display:none;margin-top:10px}
.serviceBody.active{display:block}
/* promo price formatting */
.oldPrice{color:var(--danger);text-decoration:line-through;font-weight:700}
.newPrice{color:var(--success);font-weight:800}
.promoTag{display:inline-block;margin-left:8px;color:var(--success);font-weight:700;font-size:12px}
.hr{height:1px;background:rgba(196,181,253,.18);margin:12px 0;border-radius:999px}

.floating-total{
  position:fixed;
  right:20px;
  bottom:20px;
  background:#0f1117;
  border:1px solid rgba(139,92,246,.4);
  box-shadow:0 15px 35px rgba(0,0,0,.5);
  border-radius:16px;
  padding:14px 16px;
  min-width:200px;
  z-index:9999;
  transition:all .25s ease;
}

.floating-total.hidden{
  opacity:0;
  pointer-events:none;
  transform:translateY(10px);
}

.ft-title{
  font-size:12px;
  color:var(--muted);
  margin-bottom:6px;
}

.ft-price{
  font-size:18px;
  font-weight:800;
  color:var(--success);
}

.ft-discount{
  font-size:12px;
  margin-top:4px;
  color:#facc15;
}

</style>
</head>
<body>
<div class="wrap">
  <div class="header">
    <h1>SEKAI DOTA BOOST</h1>
    <div class="sub"><strong>SITE EM BETA TESTER</strong> ‚Ä¢ valores exibidos podem conter ERROS e s√£o revisados pelo SEKAI. ‚ö†Ô∏è</div>
  
  </div>

  <div class="grid">
    <!-- Boost Tradicional -->
    <div class="card">
      <h2>
        <span>Boost Tradicional</span>
        <span class="pill">‚≠ê Mais contratado</span>
        <span class="pill">
          <label class="check" style="margin:0">
            <input type="checkbox" id="useTrad"> Incluir
          </label>
        </span>
      </h2>

      <div class="serviceBody" id="bodyTrad">
        <div class="two">
          <div>
            <label>MMR Atual</label>
            <input type="number" id="tradAtual" min="0" max="8500" placeholder="Ex: 4000" disabled>
          </div>
          <div>
            <label>MMR Desejado (0 - 8500)</label>
            <input type="number" id="tradDesejado" min="0" max="8500" placeholder="Ex: 4500" disabled>
          </div>
        </div>

        <div class="check">
          <input type="checkbox" id="tradOff" disabled>
          <span>Servi√ßo off-stream? (transmiss√£o na Twitch sekai_oficial)</span>
        </div>
        <small class="muted">Obs.: o c√°lculo de off-stream √© interno e n√£o exibe dias.</small>

<!-- SUGERIR PRE√áO -->

        <div class="hr"></div>

<div class="check">
  <input type="checkbox" id="tradSuggest">
  <span>üí° Tenho um valor em mente, at√© onde chego de MMR?</span>
</div>

<div id="tradSuggestBox" style="display:none">
  <label>Quanto voc√™ quer investir? (R$)</label>
  <input type="number" id="tradBudget" min="50" placeholder="Ex: 300">

  <div class="result" id="tradSuggestRes">
    Preencha o valor para receber uma sugest√£o.
  </div>
</div>


        <!-- SAIBA MAIS -->
        <details>
  <summary>Saiba mais sobre o Boost Tradicional</summary>

  <p><strong>üîΩ Abaixo de 4.000 MMR (valor fixo)</strong></p>
  <ul>
    <li>Servi√ßo para contas abaixo de 4.000 MMR</li>
    <li>Pedido m√≠nimo: 500 MMR</li>
    <li>üí∞ Valor: R$ 200,00 a cada 500 MMR</li>
  </ul>

  <p><strong>üîº Acima de 4.000 MMR</strong></p>
  <ul>
    <li>O valor passa a ser calculado de forma personalizada</li>
    <li>Basta informar o MMR atual para c√°lculo exato</li>
  </ul>

  <p><strong>üîÑ Margem de erro</strong></p>
  <ul>
    <li>Ajuste gratuito de at√© ¬±100 MMR</li>
    <li>Acima disso, o valor ser√° recalculado</li>
  </ul>

  <p><strong>üìå Como contratar:</strong><br>
  Utilize nossa calculadora para gerar seu or√ßamento.</p>
</details>


        <div class="result" id="tradRes">Preencha os dados para ver o valor.</div>
        <div class="alert" id="tradAlert"></div>
      </div>
    </div>

    <!-- Double MMR -->
    <div class="card">
      <h2>
        <span>Double MMR</span>
        <span class="pill">‚ö° Mais pr√°tico</span>
        <span class="pill">
          <label class="check" style="margin:0">
            <input type="checkbox" id="useDouble"> Incluir
          </label>
        </span>
      </h2>

      <div class="serviceBody" id="bodyDouble">
        <label>MMR Atual</label>
        <input type="number" id="doubleMMR" min="0" placeholder="Ex: 3200" disabled>

        <label>Dias contratados (1 a 7)</label>
        <input type="number" id="doubleDays" min="1" max="7" value="1" disabled>

        <div class="check">
          <input type="checkbox" id="doubleOff" disabled>
          <span>Double MMR Off stream (+ R$20,00) na Twitch sekai_oficial</span>
        </div>

        <!-- SAIBA MAIS -->
        <details>
  <summary>Saiba mais sobre o Double MMR</summary>

  <p><strong>üé¥ Como funciona</strong></p>
  <ul>
    <li>O Double MMR utiliza fichas de Double Down</li>
    <li>Cada dia cont√©m <strong>7 partidas</strong></li>
    <li>O c√°lculo √© feito <strong>dia por dia</strong>, conforme o MMR atual</li>
  </ul>

  <p><strong>üí∞ Pre√ßo por faixa de MMR</strong></p>
  <ul>
    <li>üü¢ <strong>0 a 4.000 MMR</strong> ‚Üí R$ 70,00 por dia</li>
    <li>üü° <strong>4.001 a 5.000 MMR</strong> ‚Üí R$ 122,50 por dia</li>
    <li>üî¥ <strong>5.001 a 6.000 MMR</strong> ‚Üí R$ 245,00 por dia</li>
  </ul>

  <p><strong>‚ö†Ô∏è Importante</strong></p>
  <ul>
    <li>O valor pode mudar durante o servi√ßo conforme o MMR sobe</li>
    <li>Cada nova di√°ria √© cobrada pelo MMR atual do dia</li>
    <li>M√°ximo permitido: <strong>6.000 MMR</strong></li>
    <li>M√°ximo de contrata√ß√£o: <strong>7 dias</strong></li>
  </ul>

  <p><strong>üìå Exemplo pr√°tico</strong></p>
  <p>
    MMR inicial: 4.900<br>
    Dia 1 ‚Üí R$ 122,50<br>
    Dia 2 ‚Üí R$ 245,00<br>
    <strong>Total:</strong> R$ 367,50
  </p>
</details>

<div class="result" id="doubleRes">Selecione as op√ß√µes para ver o valor.</div>
<div class="alert" id="doubleAlert"></div>
      </div>
    </div>

    
    <!-- Boost Casual -->
    <div class="card">
      <h2>
        <span>Boost Casual</span>
        <span class="pill">üí∞ Melhor custo-benef√≠cio</span>
        <span class="pill">
          <label class="check" style="margin:0">
            <input type="checkbox" id="useCasual"> Incluir
          </label>
        </span>
      </h2>

      <div class="serviceBody" id="bodyCasual">
        <label>Quantos dias de servi√ßo? (1 a 30)</label>
        <input type="number" id="casualDays" min="1" max="30" value="1" disabled>

        <div class="check">
          <input type="checkbox" id="casualOff" disabled>
          <span>Jogar Off Stream (<span style="color:var(--danger);text-decoration:line-through;">R$ 20,00</span> ‚Üí <span style="color:var(--success);">R$ 15,00</span> por dia) na Twitch sekai_oficial</span>
        </div>

        <!-- SAIBA MAIS -->
        <details>
  <summary>Saiba mais sobre o Boost Casual</summary>

  <ul>
    <li>üéÆ 7 partidas por dia</li>
    <li>‚ùå N√£o garanto vit√≥rias</li>
    <li>üéØ Her√≥is escolhidos conforme necessidade</li>
    <li>üí∞ R$ 85,00 por dia</li>
  </ul>
  <p><strong>üìå Regras</strong></p>
  <ul>
    <li>‚úî At√© 6.500 MMR</li>
    <li>‚ùå Acima disso n√£o √© aceito</li>
    <li>‚úî 8.000+ de Behavior Score</li>
  </ul>
</details>


        <div class="result" id="casualRes">Preencha os dados para ver o valor.</div>
        <div class="alert" id="casualAlert"></div>
        <div class="badge" id="comboBadge">‚úÖ Combo ativo: Boost Casual (1 dia) + 2 Replays (1 dia) ‚Üí total do combo = R$ 155,00</div>
      </div>
    </div>

    <!-- Recalibra√ß√£o -->
    <div class="card">
      <h2>
        <span>Recalibra√ß√£o</span>
        <span class="pill">üîÑ recomendado</span>

        <span class="pill">
          <label class="check" style="margin:0">
            <input type="checkbox" id="useRecal"> Incluir
          </label>
        </span>
      </h2>

      <div class="serviceBody" id="bodyRecal">
    
        <label>MMR Atual</label>
        <input type="number" id="recalMMR" min="0" placeholder="Ex: 3500" disabled>

        <div class="check">
          <input type="checkbox" id="recalOff" disabled>
          <span>Off stream (+ R$40 fixo) na Twitch sekai_oficial</span>
        </div>

        <!-- SAIBA MAIS -->
        <details>
  <summary>Saiba mais sobre a Recalibra√ß√£o</summary>

  <p><strong>üîÑ Recalibra√ß√£o Simples</strong></p>
  <ul>
    <li>15 a 16 partidas</li>
    <li>Poss√≠vel ganho m√©dio entre 700 e 1100 MMR</li>
    <li>Indicada para contas entre 0 e 4.000 MMR</li>
  </ul>

  <p><strong>üîÑ Recalibra√ß√£o Avan√ßada</strong></p>
  <ul>
    <li>Mesma quantidade de partidas</li>
    <li>Indicada para contas entre 4.000 e 6.000 MMR</li>
    <li>Resultado pode variar conforme a conta</li>
  </ul>

  <p><strong>‚ö†Ô∏è N√£o h√° garantia de MMR final.</strong></p>
</details>


        <div class="result" id="recalRes">Preencha os dados para ver o valor.</div>
        <div class="alert" id="recalAlert"></div>
      </div>
    </div>

    <!-- Replay -->
    <div class="card">
      <h2>
        <span>An√°lise de Replay</span>
        <span class="pill">üìä Educativo</span>
        <span class="pill">
          <label class="check" style="margin:0">
            <input type="checkbox" id="useReplay"> Incluir
          </label>
        </span>
      </h2>

      <div class="serviceBody" id="bodyReplay">
        <label>Quantidade de an√°lises</label>
        <input type="number" id="repQtd" min="1" value="1" disabled>

        <label>Em quantos dias deseja dividir?</label>
        <input type="number" id="repDias" min="1" value="1" disabled>

        <div class="check">
          <input type="checkbox" id="repOff" disabled>
          <span>An√°lise Off Stream</span>
        </div>

        <!-- SAIBA MAIS -->
        <details>
  <summary>Saiba mais sobre a An√°lise de Replay</summary>

  <ul>
    <li>An√°lise t√©cnica focada em evolu√ß√£o</li>
    <li>Realizada via Discord ou Live</li>
    <li>Dura√ß√£o m√°xima: 1 hora por an√°lise</li>
  </ul>

  <p><strong>üí∞ Taxa Off Stream</strong></p>
  <ul>
    <li>R$ 10,00 por dia ‚Üí at√© 3 an√°lises</li>
    <li>R$ 20,00 por dia ‚Üí acima disso</li>
  </ul>

  <p><strong>üìå Regras</strong></p>
  <ul>
    <li>‚úî Pagamento antecipado</li>
    <li>‚úî Datas combinadas via WhatsApp</li>
    <li>‚úî Desconto apenas em dias com 2 a 3 an√°lises</li>
    <li>‚úî M√°ximo de 6 an√°lises por dia</li>
  </ul>
</details>


        <div class="result" id="repRes">Preencha os dados para ver o valor.</div>
        <div class="alert" id="repAlert"></div>
      </div>
    </div>

    <!-- Coach -->
    <div class="card">
      <h2>
        <span>Coach</span>
        <span class="pill">üéì Evolu√ß√£o real</span>
        <span class="pill">
          <label class="check" style="margin:0">
            <input type="checkbox" id="useCoach"> Incluir
          </label>
        </span>
      </h2>

      <div class="serviceBody" id="bodyCoach">
        <div class="check">
          <input type="checkbox" id="coachP1" disabled>
          <span>Coach Parte 1 ‚Äî R$ 200,00</span>
        </div>
        <div class="check">
          <input type="checkbox" id="coachP2" disabled>
          <span>Coach Parte 2 ‚Äî R$ 200,00</span>
        </div>

        <!-- SAIBA MAIS -->
    <details>
      <summary>üéì Saber mais sobre o Coach</summary>

      <p>
        Voc√™ pode marcar dia e hor√°rio de sua prefer√™ncia, com no m√≠nimo
        <strong>1 dia de anteced√™ncia</strong>, sujeito √† disponibilidade
        de ambas as partes.
      </p>

      <p><strong>üìö Parte 1 ‚Äî Aula Demonstrativa</strong></p>
      <ul>
        <li>Eu jogo 4 partidas na sua conta</li>
        <li>Voc√™ escolhe 4 her√≥is</li>
        <li>Explica√ß√£o passo a passo das decis√µes</li>
        <li>Comunica√ß√£o via Discord em tempo real</li>
        <li>Foco em mapa, leitura de jogo e tomadas de decis√£o</li>
      </ul>

      <p><strong>üìö Parte 2 ‚Äî Voc√™ joga, eu guio</strong></p>
      <ul>
        <li>Voc√™ joga com os mesmos her√≥is escolhidos</li>
        <li>Eu acompanho e guio suas decis√µes</li>
        <li>Objetivo: te tornar independente para vencer sozinho depois</li>
      </ul>
    </details>

        <div class="result" id="coachRes">Selecione as op√ß√µes para ver o valor.</div>
        <div class="alert" id="coachAlert"></div>
      </div>
    </div>

    
<!-- Informa√ß√µes de desconto -->
<div class="card big">
  <h2>
    <span>Informa√ß√µes de desconto</span>
    <span class="pill">Promo√ß√µes</span>
  </h2>

  <!-- BOT√ÉO / TOGGLE -->
  <details>
    <summary style="cursor:pointer;font-weight:700">
      üéÅ Mostrar promo√ß√µes dispon√≠veis
    </summary>

    <div style="margin-top:12px;color:var(--muted);font-size:13px;line-height:1.5">

      <div class="hr"></div>

      <details>
        <summary>üéì <strong>Coach + Replay</strong> üëâ Saiba mais sobre essa promo√ß√£o</summary>
        <p>‚Ä¢ Coach (Parte 1) + 1 An√°lise de Replay</p>
        <p>üî• A an√°lise recebe <strong>20% de desconto</strong></p>
      </details>

      <div class="hr"></div>

      <details>
        <summary>‚ö° <strong>Double MMR + Coach</strong> üëâ Saiba mais sobre essa promo√ß√£o</summary>
        <p>‚Ä¢ Double MMR + 1 Coach (Parte 1 ou Parte 2)</p>
        <p>üî• Taxa off-stream do Double MMR recebe <strong>25% de desconto</strong></p>
      </details>

      <div class="hr"></div>

      <details>
        <summary>üìä <strong>Replay ‚Äî Desconto por volume</strong> üëâ Saiba mais</summary>
        <p>‚Ä¢ De 2 a 3 an√°lises por dia</p>
        <p>üî• Taxa off-stream recebe <strong>50% de desconto</strong></p>
      </details>

      <div class="hr"></div>

      <details>
        <summary>üí∞ <strong>Boost Casual + Replay</strong> üëâ Saiba mais</summary>
        <p>‚Ä¢ Boost Casual (1 dia) + 2 An√°lises de Replay</p>
        <p>üî• As an√°lises recebem <strong>25% de desconto</strong></p>
      </details>

      <div class="hr"></div>

      <details>
        <summary>üîÑ <strong>Recalibra√ß√£o + Boost Casual</strong> üëâ Saiba mais</summary>
        <p>‚Ä¢ Recalibra√ß√£o + Boost Casual (1 dia)</p>
        <p>üî• Boost Casual recebe <strong>aprox. 6% de desconto</strong></p>
      </details>

      <div class="hr"></div>

      <small class="muted">
        Obs.: Cada servi√ßo possui c√°lculo pr√≥prio.  
        As promo√ß√µes s√£o aplicadas automaticamente quando os crit√©rios s√£o atendidos.
      </small>

    </div>
  </details>
</div>




    <!-- Total -->
<div class="card big">
  <h2><span>Resumo do pacote</span><span class="pill">Total final</span></h2>

  <!-- üî• MENSAGEM DE PROMO√á√ÉO ATIVA -->
  <div class="result ok" id="promoMessageBox" style="display:none">
    <!-- texto da promo√ß√£o aparece aqui -->
  </div>

      <div class="result" id="totalRes">Selecione servi√ßos para ver o total.</div>
      <div class="alert" id="totalAlert"></div>

      <div class="hr"></div>

<label>Cupom de desconto </label>
<input type="text" id="couponInput" placeholder="Digite seu cupom aqui">
<div class="badge" id="couponMsg"></div>

<small class="muted">
Cupons liberados somente em datas comemorativas.
N√£o acumulativo com descontos base do site.
</small>

<div class="check">
  <input type="checkbox" id="globalBS">
  <span>‚ö†Ô∏è Confirmo que a conta possui <strong>8.000+ de Behavior Score</strong></span>
</div>

      <div class="check">
  <input type="checkbox" id="packTerms">
  <span>Li e concordo que o pagamento √© necess√°rio para garantir minha vaga e que datas exatas devem ser combinadas via WhatsApp.</span>
</div>


      <button id="zapBtn" disabled>Contratar pacote via WhatsApp</button>
      <div class="footer">
  Twitch: sekai_oficial ‚Ä¢ WhatsApp: +55 21 99184-4917<br>
  <small style="opacity:0.7">
    Calculadora desenvolvida por <strong>@Kerolynchan</strong>
  </small>
</div>
</div>


<script>

/* ========= CUPONS ========= */
const COUPONS = {
  "25%OFF6ANOS": 0.25,
  "20%OFF92067906": 0.20,
  "15%OFF92067906": 0.15,
  "10%OFF92067906": 0.10,
  "5%OFF92067906":  0.05
};
let activeCoupon = null;
let couponDiscount = 0;

let activePromo = null;
let promoMessage = "";
let discountPct = 0;


  /* ========= CONTROLE GLOBAL DE PROMO√á√ïES ========= */


/* ========= helpers ========= */
const $ = (id) => document.getElementById(id);
const money = (n) => "R$ " + n.toFixed(2).replace(".", ",");
const clampInt = (v, min, max) => (isNaN(v) ? null : Math.min(Math.max(v, min), max));

/* ========= LIMITADORES DE INPUT (ANTI-EXCESSO) ========= */

function limitInput(id, min, max, fallback = max){
  const el = $(id);
  if(!el) return;

  el.addEventListener("input", () => {
    if(el.value === "") return;

    let val = Number(el.value);

    if(isNaN(val)){
      el.value = "";
      return;
    }

    if(val > max){
      el.value = fallback;
    }

    if(val < min){
      el.value = min;
    }
  });
}

/* ========= APLICA√á√ÉO DOS LIMITES ========= */

// BOOST TRADICIONAL
limitInput("tradAtual", 0, 8500, 8500);
limitInput("tradDesejado", 0, 8500, 8500);

// DOUBLE MMR
limitInput("doubleMMR", 0, 6000, 6000);
limitInput("doubleDays", 1, 7, 7);

// BOOST CASUAL
limitInput("casualDays", 1, 30, 30);

// RECALIBRA√á√ÉO
limitInput("recalMMR", 0, 6000, 6000);

// AN√ÅLISE DE REPLAY
limitInput("repQtd", 1, 6, 6);
limitInput("repDias", 1, 6, 6);


function calcTradByBudget(mmrAtual, budget){
  let mmrTemp = mmrAtual;
  let gasto = 0;

  while(mmrTemp < 8500){
    // custo para subir +1 MMR
    const custo1 = calcTradBaseProgressivo(mmrTemp, mmrTemp + 1);

    if(gasto + custo1 > budget) break;

    gasto += custo1;
    mmrTemp += 1;
  }

  return {
    mmrFinal: mmrTemp,
    gasto: gasto
  };
}

/* collapse/expand service bodies */
function syncBodies(){
  const pairs = [
    ["useTrad","bodyTrad"],
    ["useDouble","bodyDouble"],
    ["useCasual","bodyCasual"],
    ["useRecal","bodyRecal"],
    ["useReplay","bodyReplay"],
    ["useCoach","bodyCoach"],
  ];
  pairs.forEach(([chk, body]) => {
    $(body).classList.toggle("active", $(chk).checked);
  });
}


function enableGroup(useId, fields){
  const on = $(useId).checked;
  fields.forEach(f => $(f).disabled = !on);
}

function countBoostSelected(){
  return ["useTrad","useDouble","useCasual"].filter(id => $(id).checked).length;
}

function checkCoupon() {
  const input = $("couponInput").value.trim().toUpperCase();
  const msg = $("couponMsg");

  if (!input) {
    activeCoupon = null;
    couponDiscount = 0;
    msg.style.display = "none";
    updateAll();
    return;
  }

  if (COUPONS[input]) {
    activeCoupon = input;
    couponDiscount = COUPONS[input];

    msg.style.display = "block";
    msg.textContent = `‚úÖ Cupom aplicado: ${input} (${Math.round(couponDiscount*100)}% OFF)`;

  } else {
    activeCoupon = null;
    couponDiscount = 0;

    msg.style.display = "block";
    msg.style.color = "var(--danger)";
    msg.textContent = "‚ùå Cupom inv√°lido";
  }

  updateAll();
}


/* ========= Boost Tradicional (CORRIGIDO) ========= */

// c√°lculo progressivo por faixa
function calcTradBaseProgressivo(mmrAtual, mmrDesejado){
  const TABELA_PRECOS = [
    { min: 0,    max: 4000, preco: 0.40 },
    { min: 4001, max: 4500, preco: 0.65 },
    { min: 4501, max: 5000, preco: 0.75 },
    { min: 5001, max: 5500, preco: 1.10 },
    { min: 5501, max: 6000, preco: 2.10 },
    { min: 6001, max: 6500, preco: 3.20 },
    { min: 6501, max: 7000, preco: 3.80 },
    { min: 7001, max: 7500, preco: 4.75 },
    { min: 7501, max: 8000, preco: 7.60 },
    { min: 8001, max: 8500, preco: 8.50 }
  ];

  let precoTotal = 0;
  let mmrAtualTemp = mmrAtual;

  for (const faixa of TABELA_PRECOS) {
    if (mmrAtualTemp < mmrDesejado && mmrAtualTemp <= faixa.max) {
      const inicioEfetivo = Math.max(mmrAtualTemp, faixa.min);
      const fimEfetivo = Math.min(mmrDesejado, faixa.max);
      const mmrNaFaixa = fimEfetivo - inicioEfetivo;

      if (mmrNaFaixa > 0) {
        precoTotal += mmrNaFaixa * faixa.preco;
        mmrAtualTemp = fimEfetivo;
      }

      if (mmrAtualTemp >= mmrDesejado) break;
    }
  }

  return precoTotal;
}


function tradDiscountPct(mmrAtual, delta){
  // Descontos s√≥ para MMR inicial ‚â• 4000
  if(mmrAtual < 4000) return 0;

  if(delta >= 1500) return 0.12;
  if(delta >= 1250) return 0.10;
  if(delta >= 1000) return 0.08;
  if(delta >= 750)  return 0.06;
  if(delta >= 500)  return 0.04;
  return 0;
}


function calcTrad(perDayOff){
  if(!$("useTrad").checked){
    $("tradRes").innerHTML = "Preencha os dados para ver o valor.";
    $("tradAlert").textContent = "";
    return { selected:false, ok:true, total:0, totalNoPromo:0 };
  }

  const atual = clampInt(Number($("tradAtual").value), 0, 8500);
  const des   = clampInt(Number($("tradDesejado").value), 0, 8500);
  const off   = $("tradOff").checked;

  $("tradAlert").textContent = "";

  if(atual === null || des === null || des <= atual){
    $("tradRes").innerHTML = "<strong>Pre√ßo: INV√ÅLIDO</strong>";
    $("tradAlert").textContent = "üî¥ Verifique o MMR informado.";
    return { selected:true, ok:false, total:0, totalNoPromo:0 };
  }

  let delta = des - atual;

  if(atual < 4000 && delta < 500){
    delta = 500;
    $("tradAlert").textContent =
      "‚ö†Ô∏è Pedido m√≠nimo para contas abaixo de 4.000 MMR √© 500 MMR.";
  }

  // üîπ BASE DO SERVI√áO
  const base = calcTradBaseProgressivo(atual, des);

  // üîπ DESCONTO DO SERVI√áO
  const pct = tradDiscountPct(atual, delta);
  const baseValue = base - (base * pct);

  // üîπ OFF-STREAM (SEPARADO)
  let offValue = 0;
  if(off){
    const dias = Math.max(1, Math.floor(delta / 150));
    offValue = dias * perDayOff;
  }

  // üîπ TOTAL (somado apenas para controle interno)
  const total = baseValue + offValue;
  const totalNoPromo = base + offValue;

  // üîπ UI DO CARD
  
  let descontoHTML = "";

if(pct > 0){
  descontoHTML = `
    <strong>Valor base:</strong>
    <span class="oldPrice">${money(base)}</span><br>
    <strong>Desconto aplicado:</strong>
    <span class="promoTag">üî• ${Math.round(pct * 100)}% OFF</span><br>
    <strong>Valor com desconto:</strong>
    <span class="newPrice">${money(baseValue)}</span><br>
  `;
}else{
  descontoHTML = `
    <strong>Valor do servi√ßo:</strong>
    <span class="newPrice">${money(baseValue)}</span><br>
  `;
}

if(pct > 0){
  descontoHTML = `
    <strong>Valor base:</strong>
    <span class="oldPrice">${money(base)}</span><br>
    <strong>Desconto aplicado:</strong>
    <span class="promoTag">üî• ${Math.round(pct * 100)}% OFF</span><br>
    <strong>Valor com desconto:</strong>
    <span class="newPrice">${money(baseValue)}</span><br>
  `;
}else{
  descontoHTML = `
    <strong>Valor do servi√ßo:</strong>
    <span class="newPrice">${money(baseValue)}</span><br>
  `;
}

$("tradRes").innerHTML = `
  <strong>Delta considerado:</strong> ${delta} MMR<br>
  ${descontoHTML}
  <strong>Off-stream:</strong> ${off ? money(offValue) : money(0)}<br>
  <strong>Total:</strong> <span class="newPrice">${money(total)}</span>
`;


// üîÆ sugest√£o por valor
if($("tradSuggest")?.checked){
  const budget = Number($("tradBudget").value);

  if(budget > 0){
    const sug = calcTradByBudget(atual, budget);
    const ganho = sug.mmrFinal - atual;

    $("tradSuggestRes").innerHTML =
      `<strong>Com ${money(budget)} voc√™ pode chegar aproximadamente at√©:</strong><br>
       <strong>${sug.mmrFinal} MMR</strong><br>
       <span class="ok">üëâ Isso representa um ganho de +${ganho} MMR</span><br>
       <small class="muted">Estimativa baseada no c√°lculo atual.</small>`;
  }
}


  return {
    selected: true,
    ok: true,

    // üîπ valores separados
    baseValue,
    offValue,
    offLabel: "Boost Tradicional",

    // üîπ compatibilidade com o resto do sistema
    total,
    totalNoPromo,
    tradSpend: baseValue,

    text: `Boost Tradicional: +${delta} MMR | Total: ${money(baseValue)}`,

    details:
`üÜô BOOST TRADICIONAL
‚Ä¢ MMR atual: ${atual}
‚Ä¢ MMR desejado: ${des}
‚Ä¢ Quantidade: ${delta} MMR
‚Ä¢ Valor do servi√ßo: ${money(baseValue)}
‚Ä¢ Off-stream: ${off ? money(offValue) : "N√£o"}
‚Ä¢ Total: ${money(total)}`
  };
}


/* ========= Double MMR ========= */
function doubleBaseByMMR(mmr){
  if(mmr <= 4000) return 70;
  if(mmr <= 5000) return 122.5;
  if(mmr <= 6000) return 245;
  return null;
}

function calcDouble(){
  if(!$("useDouble").checked){
    $("doubleRes").innerHTML = "Preencha os dados para ver o valor.";
    return { selected:false, ok:true, total:0, totalNoPromo:0 };
  }

  let mmrAtual = clampInt(Number($("doubleMMR").value), 0, 6000);
  let days     = clampInt(Number($("doubleDays").value), 1, 7);
  const off    = $("doubleOff").checked;

  if(mmrAtual === null || days === null){
    $("doubleRes").innerHTML = "Dados inv√°lidos.";
    return { selected:true, ok:false, total:0, totalNoPromo:0 };
  }

  let baseValue = 0;
  let mmrTemp = mmrAtual;

  // üîÅ c√°lculo DIA A DIA (CORRETO)
  for(let i = 1; i <= days; i++){
    const pricePerDay = doubleBaseByMMR(mmrTemp);

    if(pricePerDay === null){
      $("doubleRes").innerHTML = "<strong>Pre√ßo: INV√ÅLIDO</strong>";
      $("doubleAlert").textContent = "üö´ Double MMR permitido apenas at√© 6.000 MMR.";
      return { selected:true, ok:false, total:0, totalNoPromo:0 };
    }

    baseValue += pricePerDay;
    mmrTemp += 150; // ganho m√©dio por dia
  }

  // üîπ OFF-STREAM
  let offOriginal = 0;
  let offValue = 0;

  if(off){
    offOriginal = days * 20;

    if(
      activePromo === null &&
      $("useCoach").checked &&
      ($("coachP1").checked || $("coachP2").checked)
    ){
      offValue = days * 15;
      activePromo = "Double MMR + Coach";
      promoMessage = "üî• Desconto da promo√ß√£o Double MMR + Coach ativada.";
    }else{
      offValue = offOriginal;
    }
  }

  const total = baseValue + offValue;
  const totalNoPromo = baseValue + offOriginal;

  $("doubleRes").innerHTML =
    `<strong>Dias contratados:</strong> ${days}<br>
     <strong>Valor do servi√ßo:</strong> ${money(baseValue)}<br>
     <strong>Off-stream:</strong> ${off ? money(offValue) : money(0)}<br>
     <strong>Total:</strong> <span class="newPrice">${money(total)}</span>`;

  return {
    selected:true,
    ok:true,

    baseValue,
    offOriginal,
    offValue,
    offLabel:"Double MMR",

    total,
    totalNoPromo,

    text:`Double MMR: ${days} dia(s) | Total: ${money(baseValue)}`,
    details:
`‚ö° DOUBLE MMR
‚Ä¢ MMR inicial: ${mmrAtual}
‚Ä¢ Dias contratados: ${days}
‚Ä¢ Valor do servi√ßo: ${money(baseValue)}
‚Ä¢ Off-stream: ${off ? money(offValue) : "N√£o"}
‚Ä¢ Total: ${money(total)}`
  };
}





/* ========= Boost Casual ========= */
function calcCasual(){
  if(!$("useCasual").checked){
    $("casualRes").innerHTML = "Preencha os dados para ver o valor.";
    return { selected:false, ok:true, total:0, totalNoPromo:0 };
  }

  const days = clampInt(Number($("casualDays").value), 1, 30);
  const off  = $("casualOff").checked;

  const baseValue = days * 85;

// üîπ OFF-STREAM
let offOriginal = 0;
let offValue = 0;
let promoApplied = false;
let offPromoText = "";

if(off){
  offOriginal = days * 20;

  if(activePromo === null){
    offValue = days * 15;
    promoApplied = true;
    offPromoText = "Promo√ß√£o fixa do Boost Casual";
  }else{
    offValue = offOriginal;
  }
}


 const total = baseValue + offValue;

// ‚úÖ ESSA LINHA √â A CORRE√á√ÉO
const totalNoPromo = baseValue + offOriginal;

$("casualRes").innerHTML =
  `<strong>Dias:</strong> ${days}<br>
   <strong>Valor do servi√ßo:</strong> ${money(baseValue)}<br>
   <strong>Off-stream:</strong> ${off ? money(offValue) : money(0)}<br>
   <strong>Total:</strong> ${money(total)}`;

return {
  selected:true,
  ok:true,

  days,

  baseValue,
  offOriginal,
  offValue,
  promoApplied,
  offPromoText,
  offLabel: "Boost Casual",

  total,
  totalNoPromo, // ‚úÖ AGORA EXISTE

  text:`Boost Casual: ${days} dia(s) | Total: ${money(baseValue)}`,
  details:`...`
};


}



/* ========= Recalibra√ß√£o ========= */
function calcRecal(){
  if(!$("useRecal").checked){
    $("recalRes").innerHTML = "Preencha os dados para ver o valor.";
    return { selected:false, ok:true, total:0, totalNoPromo:0 };
  }

  // nome removido ‚Äî n√£o ser√° mais utilizado

  const mmr  = clampInt(Number($("recalMMR").value), 0, 99999);
  const off  = $("recalOff").checked;

  if(mmr === null){
    $("recalRes").innerHTML = "Digite o MMR para calcular.";
    return { selected:true, ok:false, total:0, totalNoPromo:0 };
  }

  let baseValue = 0;

  if(mmr <= 4000){
    baseValue = 200;
  }else if(mmr <= 6000){
    baseValue = 250;
  }else{
    $("recalRes").innerHTML = "<strong>Pre√ßo: INV√ÅLIDO</strong>";
    $("recalAlert").textContent = "üö´ Esse MMR n√£o √© compat√≠vel com a Recalibra√ß√£o.";
    return { selected:true, ok:false, total:0, totalNoPromo:0 };
  }

  // üîπ OFF-STREAM (sem promo√ß√£o)
  const offOriginal = off ? 40 : 0;
  const offValue    = offOriginal;

  const total = baseValue + offValue;

  $("recalRes").innerHTML =
    `<strong>Valor do servi√ßo:</strong> ${money(baseValue)}<br>
     <strong>Off-stream:</strong> ${off ? money(offValue) : money(0)}<br>
     <strong>Total:</strong> ${money(total)}`;

  return {
    selected:true,
    ok:true,

    baseValue,

    offOriginal,
    offValue,
    promoApplied:false,
    offPromoText:"",
    offLabel:"Recalibra√ß√£o",

    total,
    totalNoPromo: baseValue + offOriginal,

    text:`Recalibra√ß√£o | Total: ${money(baseValue)}`,


    details:
`üîÑ RECALIBRA√á√ÉO
‚Ä¢ MMR atual: ${mmr}
‚Ä¢ Valor do servi√ßo: ${money(baseValue)}
‚Ä¢ Off-stream: ${off ? money(offValue) : "N√£o"}
‚Ä¢ Total: ${money(total)}`
  };
}


/* ========= Replay (CORRIGIDO) ========= */
function calcReplay(){
  if(!$("useReplay").checked){
    $("repRes").innerHTML = "Preencha os dados para ver o valor.";
    return { selected:false, ok:true, total:0, totalNoPromo:0 };
  }

  const qtd  = clampInt(Number($("repQtd").value), 1, 999);
  const dias = clampInt(Number($("repDias").value), 1, 999);
  const off  = $("repOff").checked;

  if(qtd === null || dias === null){
    $("repRes").innerHTML = "Dados inv√°lidos.";
    return { selected:true, ok:false, total:0, totalNoPromo:0 };
  }

  const porDia = Math.ceil(qtd / dias);

  if(porDia > 6){
    $("repRes").innerHTML = "<strong>Pre√ßo: INV√ÅLIDO</strong>";
    $("repAlert").textContent = "üî¥ M√°ximo de 6 an√°lises por dia.";
    return { selected:true, ok:false, total:0, totalNoPromo:0 };
  }

  /* üîπ SERVI√áO */
  let baseNoPromo = qtd * 50;
let baseValue = baseNoPromo;
let descontoReplay = 0;

// üî• DESCONTO POR VOLUME (2 ou 3 an√°lises no mesmo dia)
if(porDia >= 2 && porDia <= 3){
  baseValue = qtd * 40; // pre√ßo com desconto
  descontoReplay = baseNoPromo - baseValue;
}

  let promoApplied = false;

  if(
  activePromo === null &&
  $("useCoach").checked &&
  $("coachP1").checked &&
  qtd === 1
){
  baseValue = qtd * 40; // 20% OFF
  promoApplied = true;
  activePromo = "Coach + Replay";
  promoMessage = "üî• Desconto da promo√ß√£o Coach + Replay ativada.";
}


  /* üîπ OFF-STREAM */
  let offOriginal = 0;
  let offValue = 0;
  let offPromoText = "";

  if(off){
    offOriginal = dias * (porDia > 3 ? 20 : 10);

    if(porDia <= 3){
      offValue = dias * 10;
      offPromoText = "Promo√ß√£o: at√© 3 an√°lises por dia";
    }else{
      offValue = dias * 20;
    }
  }

  const total = baseValue + offValue;
  const totalNoPromo = baseNoPromo + offOriginal;

  let replayHTML = `
  <strong>An√°lises:</strong> ${qtd}<br>
  <strong>Dias:</strong> ${dias}<br>
`;

if(descontoReplay > 0){
  const pct = Math.round((descontoReplay / baseNoPromo) * 100);

  replayHTML += `
    <strong>Valor base:</strong> ${money(baseNoPromo)}<br>
    <strong>Desconto aplicado:</strong> üî• ${pct}% OFF<br>
    <strong>Valor com desconto:</strong> <span class="newPrice">${money(baseValue)}</span><br>
  `;
}else{
  replayHTML += `
    <strong>Valor do servi√ßo:</strong> ${money(baseValue)}<br>
  `;
}

replayHTML += `
  <strong>Off-stream:</strong> ${off ? money(offValue) : money(0)}<br>
  <strong>Total:</strong> <span class="newPrice">${money(total)}</span>
`;

$("repRes").innerHTML = replayHTML;


  return {
  selected:true,
  ok:true,

  qtd,
  dias,

  baseValue,
  offOriginal,
  offValue,
  offLabel: "Replay",

  total,
  totalNoPromo,

  descontoReplay, // üî• NOVO

  text:`Replay: ${qtd} an√°lise(s) divididos em ${dias} dia(s) | Total: ${money(baseValue)}`,

 details:
`üìä AN√ÅLISE DE REPLAY
‚Ä¢ An√°lises: ${qtd}
‚Ä¢ Dias: ${dias}
‚Ä¢ Valor base: ${money(baseNoPromo)}
${descontoReplay > 0 
  ? `‚Ä¢ Desconto aplicado: üî• ${Math.round((descontoReplay / baseNoPromo) * 100)}% OFF`
  : `‚Ä¢ Desconto aplicado: Nenhum`}
‚Ä¢ Valor com desconto: ${money(baseValue)}
‚Ä¢ Off-stream: ${off ? money(offValue) : "R$ 0,00"}
‚Ä¢ Total: ${money(total)}`

};



}


/* ========= Coach ========= */
function calcCoach(tradEligible){
  if(!$("useCoach").checked){
    $("coachRes").innerHTML = "Selecione as op√ß√µes para ver o valor.";
    $("coachAlert").textContent = "";
    return {selected:false, ok:true, total:0, totalNoPromo:0, text:"", coachDiscount:0};
  }

  const p1 = $("coachP1").checked;
  const p2 = $("coachP2").checked;

  $("coachAlert").textContent = "";

  if(p2 && !p1){
    $("coachAlert").textContent =
      "‚ö†Ô∏è Para obter desconto na Parte 2, √© necess√°rio contratar a Parte 1.";
  }

  let base = 0;
  if(p1) base += 200;
  if(p2) base += 200;

  // desconto: 50% na parte 2 se Boost Tradicional >= R$200
  let disc = 0;
  if(p1 && p2 && tradEligible){
    disc = 100;
  }

  const total = base - disc;
  const totalNoPromo = base;

  $("coachAlert").textContent =
    disc > 0 ? "‚úÖ Promo√ß√£o: 50% OFF aplicado na Parte 2 do Coach." : "";

  $("coachRes").innerHTML =
    `<strong>Base:</strong> ${money(base)}<br>
     <strong>Desconto:</strong> ${disc>0 ? ("- " + money(disc)) : money(0)}<br>
     <strong>Total:</strong> ${money(total)}`;

  return {
    selected:true,
    ok:true,
    total,
    totalNoPromo,
    text:`Coach | Total: ${money(total)}`,
    details:
`üéì COACH
‚Ä¢ Parte 1: ${p1 ? "Sim" : "N√£o"}
‚Ä¢ Parte 2: ${p2 ? "Sim" : "N√£o"}
‚Ä¢ Desconto aplicado: ${disc > 0 ? money(disc) : "Nenhum"}
‚Ä¢ Total: ${money(total)}`
  };
}


/* ========= Combo controlado ========= */
function comboCasualReplay(cas, rep){
  // üî• Combo: Boost Casual + Replay
  if(
    activePromo === null &&
    cas.selected && cas.ok &&
    rep.selected && rep.ok &&
    cas.days === 1 &&
    rep.qtd === 2 &&
    rep.dias === 1
  ){
    activePromo = "Boost Casual + Replay";
    promoMessage = "üî• Desconto da promo√ß√£o Boost Casual + Replay ativada.";

    const normal = cas.total + rep.total;
    return { active:true, delta:(155 - normal) };
  }

  return { active:false, delta:0 };
}


function offBoostPerDay(){
  return 20; // valor padr√£o
}


/* ========= update all ========= */
function updateAll(){

  // üî• RESET GLOBAL DE PROMO√á√ïES (OBRIGAT√ìRIO)
  activePromo = null;
  promoMessage = "";

  // üî• isso garante que promo√ß√µes antigas morram
  syncBodies();



   // üîÆ CONTROLE DA SUGEST√ÉO POR VALOR
  const sug = $("tradSuggest");
  const box = $("tradSuggestBox");

  if(sug && box){
    box.style.display = sug.checked ? "block" : "none";
  }
  // üîí trava MMR desejado quando sugest√£o estiver ativa
if(sug && sug.checked){
  $("tradDesejado").disabled = true;
}else{
  $("tradDesejado").disabled = false;
}


  enableGroup("useTrad",   ["tradAtual","tradDesejado","tradOff"]);
  enableGroup("useDouble", ["doubleMMR","doubleDays","doubleOff"]);
  enableGroup("useCasual", ["casualDays","casualOff"]);
  enableGroup("useRecal",  ["recalMMR","recalOff"]);
  enableGroup("useReplay", ["repQtd","repDias","repOff"]);
  enableGroup("useCoach",  ["coachP1","coachP2"]);

  const perDayOff = offBoostPerDay();

  const trad = calcTrad(perDayOff);
  const dbl  = calcDouble(perDayOff);
  const cas  = calcCasual();
  const rec  = calcRecal();
  const rep  = calcReplay();

  // trad eligibility for coach discount: trad selected, ok, and spend >= 200
  const tradEligible = trad.selected && trad.ok && trad.tradSpend >= 200;

  const coach = calcCoach(tradEligible);

  const selectedAny = [trad,dbl,cas,rec,rep,coach].some(x => x.selected);
  const packTerms = $("packTerms").checked;
  const bs = $("globalBS").checked;

  let total = 0;
  let totalNoPromo = 0;
  let items = [];
  let invalid = [];
  let offLines = [];
let offTotal = 0;


  [trad,dbl,cas,rec,rep,coach].forEach(obj => {
  if(obj.selected){
    if(!obj.ok){
      invalid.push("‚ö†Ô∏è Corrija os dados de um dos servi√ßos selecionados.");
    }else{
      total += obj.total;
      totalNoPromo += obj.totalNoPromo;

      // item principal
      items.push("‚Ä¢ " + obj.text);

      // ‚úÖ DESCONTO DE VOLUME DO REPLAY (AQUI üëá)
      if(obj.descontoReplay && obj.descontoReplay > 0){
        items.push(`‚Ä¢ Replay ‚Äî desconto por volume: -${money(obj.descontoReplay)}`);
      }

      // üîπ captura OFF-STREAM
      if(obj.offValue && obj.offValue > 0){
        offLines.push(`‚Ä¢ ${obj.offLabel}: ${money(obj.offValue)}`);
        offTotal += obj.offValue;
      }
    }
  }
});


  // ===== calcula porcentagem de desconto total =====


  // apply combo casual+replay
  const combo = comboCasualReplay(cas, rep);
  if(combo.active){
    $("comboBadge").style.display = "block";
    total += combo.delta;
    // totalNoPromo n√£o muda aqui (mant√©m sem combo)
    items.push("‚Ä¢ Promo√ß√£o combo: Boost Casual (1 dia) + 2 Replays (1 dia) ‚Üí R$ 155,00");
  } else {
    $("comboBadge").style.display = "none";
  }
  
// ===== calcula porcentagem de desconto FINAL =====

// üî• CUPOM TEM PRIORIDADE TOTAL
if (activeCoupon && couponDiscount > 0) {
  total = totalNoPromo * (1 - couponDiscount);
  discountPct = Math.round(couponDiscount * 100);
} else {
  // ‚ùå sem cupom ‚Üí desconto vem das promo√ß√µes normais
  discountPct = totalNoPromo > 0
    ? Math.round((1 - total / totalNoPromo) * 100)
    : 0;
}




  // total UI
  if(!selectedAny){
    $("totalRes").innerHTML = "Selecione servi√ßos para ver o total.";
    $("totalAlert").textContent = "";
    $("zapBtn").disabled = true;
    return;
  }

  // price highlight if promo differs
const hasPromo = Math.abs(totalNoPromo - total) > 0.009;

const priceLine = hasPromo
  ? `<div style="margin-top:6px">
       <span class="oldPrice">${money(totalNoPromo)}</span>
       <span style="margin:0 8px;color:var(--muted)">‚Üí</span>
       <span class="newPrice">${money(total)}</span>
       ${discountPct > 0 ? `<span class="promoTag">üî• ${discountPct}% OFF</span>` : ""}
     </div>`
  : `<div style="margin-top:6px">
       <span class="newPrice">${money(total)}</span>
     </div>`;


  $("totalRes").innerHTML =
  `<strong>Itens selecionados:</strong><br>
   ${items.join("<br>")}
   
   ${
     offLines.length
       ? `<br><br><strong>üì° Taxas Off-stream:</strong><br>
          ${offLines.join("<br>")}
          <br><strong>Total Off-stream:</strong> ${money(offTotal)}`
       : ""
   }

   <br><br><strong>üíµ Total final:</strong>${priceLine}`;

   // üîî MENSAGEM DE PROMO√á√ÉO ATIVA
const promoBox = $("promoMessageBox");

if(promoMessage){
  promoBox.style.display = "block";
  promoBox.textContent = promoMessage;
}else{
  promoBox.style.display = "none";
}


  let alerts = [];
  if(invalid.length) alerts.push(invalid[0]);
  if(!bs) alerts.push("‚ö†Ô∏è √â necess√°rio possuir mais de 8k de Behavior Score.");
  if(!packTerms) alerts.push("‚ö†Ô∏è √â necess√°rio aceitar os termos do pacote para continuar.");
  $("totalAlert").innerHTML = alerts.join("<br>");

  const canZap = (invalid.length === 0) && packTerms && bs;

// ESSA LINHA √â O QUE FALTAVA üëá
$("zapBtn").disabled = !canZap;

$("zapBtn").onclick = () => {
  let detalhes = [];

  [trad,dbl,cas,rec,rep,coach].forEach(obj => {
    if(obj.selected && obj.ok && obj.details){
      detalhes.push(obj.details);
    }
  });
  let offLines = [];
let offTotal = 0;

[trad,dbl,cas,rec,rep,coach].forEach(obj => {
  if(obj.selected && obj.ok && obj.offValue > 0){
    offLines.push(`‚Ä¢ ${obj.offLabel}: ${money(obj.offValue)}`);
    offTotal += obj.offValue;
  }
});


  const msg = encodeURIComponent(
  "Ol√°! Quero contratar um pacote na *SEKAI DOTA BOOST*.\n\n" +
  detalhes.join("\n\n") +

  (offLines.length
    ? "\n\nüì° *TAXAS OFF-STREAM*\n" +
      offLines.join("\n") +
      "\n‚Ä¢ Total Off-stream: " + money(offTotal)
    : ""
  ) +

  (activeCoupon
    ? "\n\nüéüÔ∏è *CUPOM APLICADO:* " + activeCoupon +
      " (" + Math.round(couponDiscount * 100) + "% OFF)"
    : ""
  ) +
  
  "\n\nüíµ *TOTAL FINAL:* " + money(total) +
  "\n\nObs.: Datas ser√£o combinadas via WhatsApp."
);

window.open("https://wa.me/5521991844917?text=" + msg);
}; 
/* ===== AQUI COME√áA O BAL√ÉO FLUTUANTE ===== */

const floatBox = $("floatingTotal");
const ftPrice  = $("ftPrice");
const ftDisc   = $("ftDiscount");


if(selectedAny){
  floatBox.classList.remove("hidden");

  if(hasPromo){
    ftPrice.innerHTML = `
      <span class="oldPrice" style="font-size:13px">${money(totalNoPromo)}</span><br>
      <span class="newPrice">${money(total)}</span>
    `;
    ftDisc.textContent = `üî• ${discountPct}% OFF aplicado`;
  }else{
    ftPrice.textContent = money(total);
    ftDisc.textContent = "";
  }
}else{
  floatBox.classList.add("hidden");
}
}



[
  "useTrad","useDouble","useCasual","useRecal","useReplay","useCoach",
  "tradAtual","tradDesejado","tradOff",
  "doubleMMR","doubleDays","doubleOff",
  "casualDays","casualOff",
  "recalMMR","recalOff",
  "repQtd","repDias","repOff",
  "coachP1","coachP2","coachOff",
  "packTerms","globalBS",
  "tradSuggest","tradBudget"
].forEach(id => {
  const el = $(id);
  if(!el) return;
  el.addEventListener(el.type === "checkbox" ? "change" : "input", updateAll);
});

// üëá COLE EXATAMENTE AQUI
$("couponInput").addEventListener("input", checkCoupon);

updateAll();


/* ===== CONTROLE DE SCROLL DO BAL√ÉO ===== */
let lastScrollY = window.scrollY;

window.addEventListener("scroll", () => {
  const floatBox = $("floatingTotal");
  if(!floatBox) return;

  const currentY = window.scrollY;

  // Rolando para baixo ‚Üí esconde
  if(currentY > lastScrollY + 10){
    floatBox.classList.add("hidden");
  }

  // Rolando para cima ‚Üí mostra
  if(currentY < lastScrollY - 10){
    floatBox.classList.remove("hidden");
  }

  lastScrollY = currentY;
});
</script>
<!-- Mini carrinho flutuante -->
<div id="floatingTotal" class="floating-total hidden">
  <div class="ft-title">üíº Seu pacote</div>
  <div id="ftPrice" class="ft-price">R$ 0,00</div>
  <div id="ftDiscount" class="ft-discount"></div>
</div>

</body>
</html>
